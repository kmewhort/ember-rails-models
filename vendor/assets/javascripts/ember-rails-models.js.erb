<!-- Auto-generated by ember-rails-models -->
<% EmberRailsModels::Schema.all.each do |schema| %>
  <%= EmberRailsModels.app_name.camelize %>.<%= schema.model_name %> = DS.Model.extend({
    <% schema.attributes.each do |attr|
      %><%= attr[:name] %>: DS.attr('<%= attr[:type] %>'),
    <% end %>

    <% schema.associations.each do |assoc|
      %><%= assoc[:name] %>: DS.<%= assoc[:type] %>('<%= assoc[:references] %>'<%= assoc[:properties] ? ", #{assoc[:properties].to_json}": '' %>),
    <% end %>
  });

<% end %>
<!-- end of ember-rails-models auto-generation -->

<!-- Additional transforms for Rails/mongo compatibility -->

// see http://stackoverflow.com/questions/12168570/how-to-represent-arrays-within-ember-data-models
DS.ArrayTransform = DS.Transform.extend({
  deserialize: function(serialized) {
    return (Ember.typeOf(serialized) == "array")
        ? serialized
        : [];
  },

  serialize: function(deserialized) {
    var type = Ember.typeOf(deserialized);
    if (type == 'array') {
        return deserialized
    } else if (type == 'string') {
        return deserialized.split(',').map(function(item) {
            return jQuery.trim(item);
        });
    } else {
        return [];
    }
  }
});
<%= EmberRailsModels.app_name.camelize %>.register("transform:array", DS.ArrayTransform);

// json 'object' type to models
DS.ObjectTransform = DS.Transform.extend({
  deserialize: function(serialized) {
    return Ember.isNone(serialized) ? null : serialized;
  },
  serialize: function(deserialized) {
    return Ember.isNone(deserialized) ? null : deserialized;
  }
});
<%= EmberRailsModels.app_name.camelize %>.register("transform:object", DS.ObjectTransform);
